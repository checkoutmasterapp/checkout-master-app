extends ../../layouts/backend_layout

block header_breadcrumb
	nav
		ol.breadcrumb
			li.breadcrumb-item Home
			li.breadcrumb-item.active Upsell

block content 
	main#main.main
		section.section.upsell
			.main-performes.row
				.heading.col-lg-4.col-md-4
					h1.text-up-n Upsell Performance
				.col-lg-8.col-md-8
					.calendar.float-end
						label.degin-labl From
							svg.ms-1.celender(xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512')
								path(d='M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z')  
							input.border-0.lab-date.performance_filter(type="text" name="performance_start")
						label.degin-labl.me-0 To
							svg.ms-1.celender(xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512')
								path(d='M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z')
							input.border-0.lab-date.performance_filter(type="text" name="performance_end")

			.row.mt-4.mb-4.upsell_performance_section
				.col-lg-3.col-md-6
					.data-prst.persnt.pt-4.px-3.pb-3
						h2.text-degin-prtisht 0%
						p.p_degin-pertisht CONVERSION RATE
				.col-lg-3.col-md-6 
					.data-prst.persnt.pt-4.px-3.pb-3
						h2.text-degin-prtisht 0
						p.p_degin-pertisht TIMES SHOWN
				.col-lg-3.col-md-6
					.data-prst.persnt.pt-4.px-3.pb-3
						h2.text-degin-prtisht 0
						p.p_degin-pertisht TIMES PURCHASED
				.col-lg-3.col-md-6
					.data-prst.persnt.pt-4.px-3.pb-3
						h2.text-degin-prtisht $0.00
						p.p_degin-pertisht UPSELL REVENUE

			section.section.upsell-1
				input(type="hidden" name="store_id" class="store_id" value=store_id)
				input(type="hidden" name="upsell_id" class="upsell_id" value=upsell_detail.id)
				input(type="hidden" name="upsell_uuid" class="upsell_uuid" value=upsell_detail.upsell_uuid)

				div.row
					div.col-xl-7
						div
							div.main-right-upper
								div.upsell-card.d-flex.flex-column
									h2 Upsell Triggers
									p Select a product that will trigger the post-purchase upsell when bought. You can select products and categories. We recommend not to mix them as triggers.

								div.card
									div.card-body.pt-3
										div.tab-content.row.align-items-baseline
											div.col-12.add-uppsel-section.px-0
												.selected-products
												.selected_collections

											div.col-12.mt-4.d-flex.px-0.btn-w-txt
												div.name_view.w-100.text-start Select a product or category trigger
												div.class_but.d-flex.justify-content-center
													button#add_product_button.btn.btn-secondary.rounded-r-none.mx-1 Add Product
													button#add_category_button.btn.btn-primary.border-l-0.rounded-l-none.mx-1 Add category
							div.main-right-upper.mt-5
								div.upsell-card.pt-4.d-flex.flex-column
									h2 Upsell Offer Title
									p Add an attention-grabbing title for your post-purchase upsell. Offer title is required for your upsell.

								div.card
									div.card-body.p-0
										div.tab-content
											div.space-y-4.mt-4
												span.block.text-sm.font-bold(for="") Title
												div
													input.text-sm.form-control#upsell-offer-title.required(
														type="text"
														placeholder="Wait! Limited time offer!"
														name="upsell_title"
														value=`${upsell_detail?upsell_detail.upsell_title:"Wait! Limited time offer!"}`
													)
							div.main-right-upper.mt-5
								div.upsell-card.pt-4.d-flex.flex-column
									h2 Post-Purchase Upsell Offers
									p Create up to 3 product upsell offers. When the customer adds or discards an upsell, the next offer will be shown.
								div.card
									div.card-body.pt-3.px-0
										div.tab-content.upsell_offer_html.upsell_offer_sortable


					div.col-xl-5
						div
							div.add-uppsel-section
								div.upsell-card.d-flex.flex-column
									h2 Summary
								div.card.card_c
									div.card-body.p-0
										div.tab-content.pt-2
											div.row
												div.flex.items-center.col-10
													div.flex-1.upsell-status.upsell_status 
														| !{upsell_detail && upsell_detail.status == true ? "Active" : "Inactive"}
												div.col-2
													.form-check.form-switch
														input#flexSwitchCheckDefault.form-check-input(
															type='checkbox'
															role='switch'
															checked= upsell_detail && upsell_detail.status == true ? true : false
														)
										div
											div 
												ul.text-sm.list-disc.list-inside.space-y-4
													li.space-y-4.trigger-summery.d-flex.align-items-center
														label When a customer buys:
														div.trigger_summery_section
													li.space-y-4.offer-summery These offers will be shown:
														div.text-muted.upsell_title_summery
															| !{upsell_detail?upsell_detail.upsell_title:"Wait! Limited time offer"}
														div.offer_summery_section

										.flex.justify-center.pt-4
											a.btn.btn-primary.me-3.w-100#preview_upsell(
												href=`/${store_id}/preview-upsell/${upsell_detail.upsell_uuid}`
											) Preview upsell

							div.card
								div.card-body.p-0
									div.tab-content.pt-2
										div.main-right-upper.mt-5
											div.space-y-4
												h3.text-sm.font-weight-bold.text-uppercase Need help?
												p.text-sm.likee-it-txt Make the most out of your post-purchase upsells by learning more in our Help Center or reaching out to our customer support team.
												div.mt-4.text-center.upsell_acnhor
													a.text-sm(href="#") Read more about upsells

						div.col-12.d-flex.justify-content-end 
							button.btn.btn-primary.me-3.w-100#delete_upsell Delete Upsell
							button.btn.btn-primary.w-100#update_upsell Update Upsell


		// Model Section Start
		div#add_product_model.modal.fade(aria-hidden='true' data-function='products-picker' role='dialog' tabindex='-1')
			div.modal-dialog.modal-dialog-scrollable.modal-lg
				div.modal-content
					div.modal-header.row
						div.modal-header-titled.col-6
							h3.modal-title Select items for your upsell trigger
							p#product_selected 0 items selected
						div.col-6.d-flex.justify-content-end
							div.custom-control.custom-checkbox
								input#upsell_trigger_selectall_products.custom-control-input(type='checkbox')
								label.custom-control-label(for='upsell_trigger_selectall_products') Select all 
						div.searchbox
							.input-group
								span.input-group-text
									i.bi.bi-search(aria-hidden='true')
								input.form-control(type="text" placeholder="Search..." name="product_search" value="")
					div.modal-body.products-body.check-product
					div.modal-footer
						button#cancel_btn_products.btn.btn-primary(type='button' ) Cancel
						button.add_product.btn.btn-primary(data-function='add-products' type='button' disabled="true") Add Product

		div#add_category_modal.modal.fade(aria-hidden='true' data-function='products-picker' role='dialog' tabindex='-1')
			div.modal-dialog.modal-dialog-scrollable.modal-lg
				div.modal-content
					div.modal-header.row
						div.modal-header-titled.col-6                                
							h3.modal-title Select items for your upsell trigger
							span.text-sm.text-muted#selected-items 0 items selected
						div.col-6.d-flex.justify-content-end
							div.custom-control.custom-checkbox
								input#upsell_trigger_selectall_collections.custom-control-input(type='checkbox')
								label.custom-control-label(for='upsell_trigger_selectall_collections') Select all
						div.searchbox
							.input-group
								span.input-group-text
									i.bi.bi-search(aria-hidden='true')
								input.form-control(type="text" placeholder="Search..." name="category_search" value="")
					div.modal-body.categories-body
					div.modal-footer
						button#cancel_btn_categories.btn.btn-primary(type='button' ) Cancel
						button#add_category.btn.btn-primary(type='button' disabled="true") Add Category

		div#upsell_offer_product_modal.modal.fade(aria-hidden='true' data-function='products-picker' role='dialog' tabindex='-1')
			div.modal-dialog.modal-dialog-scrollable.modal-lg
				input(type="hidden" name="sort_order" value="0")
				div.modal-content
					div.modal-header.row
						div.modal-header-titled.col-6
							h3.modal-title Select product for your upsell offer
						div.col-6.d-flex.justify-content-end
						div.searchbox
							.input-group
								span.input-group-text
									i.bi.bi-search(aria-hidden='true')
								input.form-control(type="text" placeholder="Search..." name="offers_product_search" value="")

					div.modal-body.upsell_offer_product_body
					div.modal-footer
						button#upsell_offer_product_cancel.btn.btn-primary(type='button' ) Cancel
						button#upsell_offer_product_add.btn.btn-primary(type='button' disabled="true") Add Product

		div#edit_upsell_variant_offer_modal.modal.fade(aria-hidden='true' data-function='products-picker' role='dialog' tabindex='-1')
			div.modal-dialog.modal-dialog-scrollable.modal-lg
				div.modal-content
					div.modal-header.row
						div.modal-header-titled.col-6
							h3.modal-title Edit product variants
					div.modal-body.edit_upsell_variant_offer_body(data-function='items-container')
					div.modal-footer
						button#edit_upsell_variant_offer_cancel.btn.btn-primary(type='button' ) Cancel
						button#edit_upsell_variant_offer_update.btn.btn-primary(type='button') Apply

		div#product_trigger_overlap_model.modal.fade(aria-hidden='true' role='dialog' tabindex='-1')
			div.modal-dialog.modal-dialog-scrollable.modal-lg
				div.modal-content
					div.modal-header
						div.modal-header-titled
							h3.modal-title Overlapping triggers
							p You are running A/B test on multiple products. If you decide to stop the A/B test, turn the triggers you want to stop using the Status toggle.
					div.modal-body
					div.modal-footer
						button#product_trigger_overlap_model_close.btn.btn-primary(type='button' ) Close

block scripts
	script.
		var store_id = `!{store_id}`;
		var product_details = !{JSON.stringify(product_details)};
		var collection_details = !{JSON.stringify(collection_details)};
		var exist_upsell_lists = !{JSON.stringify(exist_upsell_lists)};

		var upsell_id = `!{upsell_detail.id}`;
		var upsell_trigger_delete = [];
		var upsell_trigger_offers_delete = [];

		var upsell_detail = !{JSON.stringify(upsell_detail)};
		var upsell_triggers = !{JSON.stringify(upsell_triggers)};
		var upsell_trigger_offers = !{JSON.stringify(upsell_trigger_offers)};
		var upsell_performance_record = !{JSON.stringify(upsell_performance_record)};
	script(type='text/javascript' src='/assets/js/custom/upsell.js')