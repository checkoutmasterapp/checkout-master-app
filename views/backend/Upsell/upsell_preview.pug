extends ../../layouts/backend_layout

block header_style
    link(rel="stylesheet", href=`/assets/css/shopify/upsell.css`)

block content 
    main#main.main-data.checkout
        section.upsell-preview-section.container.mini
            .container

                // Publish Checkout
                .row
                    .col-lg-12
                        .publish_checkout.mb-3
                            input(type="hidden" id="storeId" value=`${store_id}`)
                            a.btn.btn-primary.save-checkout.me-sm-3.mb-2.mb-sm-0(
                                href="javascript:history.back()"
                            ) Back to Upsell
                            input(type="hidden" id="storeId" value=`${store_id}`)
                            a.btn.btn-primary.save-checkout.me-sm-3.mb-2.mb-sm-0(
                                href=`/${store_id}/customize-checkout`
                            ) Customise Checkout
                        if(customize_checkout)
                            .logos
                                if(customize_checkout && customize_checkout.store_logo)
                                    img.h-12.store-logo(src=`${customize_checkout?customize_checkout.store_logo:''}` )
                                if(customize_checkout && customize_checkout.security_badge)
                                    img.h-12.security-logo(src=`${customize_checkout?customize_checkout.security_badge:''}` )
                                else
                                    img.h-12.security-logo(src='/assets/img/security_badge.png')

                    .col-12
                        .card.upsell-wrapper
                            .upsell-heading-wrapper
                                h2.text-center.upsell-title
                                    | !{upsell_detail.upsell_title}

                                each upsell_trigger_offer, upsell_trigger_offer_index in upsell_trigger_offers

                                    div.upsell_section.displaynone(id=`upsell_section_${upsell_trigger_offer_index}`)
                                        input.form-control(
                                            type='hidden'
                                            id=`product_id_${upsell_trigger_offer_index}`
                                            value=`${upsell_trigger_offer.product_id}`
                                        )
                                        input.form-control(
                                            type='hidden'
                                            id=`compare_at_price_${upsell_trigger_offer_index}`
                                            value=`${upsell_trigger_offer.compare_at_price}`
                                        )
                                        input.form-control(
                                            type='hidden'
                                            id=`product_price_${upsell_trigger_offer_index}`
                                            value=`${upsell_trigger_offer.product_price}`
                                        )

                                        .d-lg-flex
                                            .upsell-slider-wrapper
                                                .upsell-slider.space-4
                                                    .upsell-slide
                                                        img(src=`${upsell_trigger_offer.product_image}`)

                                            .upsell-content.space-top-4.space-4
                                                h2.text-center.text-lg-left.js-upsell-product-title !{upsell_trigger_offer.product_title}

                                                if(upsell_trigger_offer.product_variants.length > 1)
                                                    .custom-select-wrapper.space-4
                                                        select.custom-select.upsell_product_variant(id=`upsell_product_variant_${upsell_trigger_offer_index}`)
                                                            each product_variant, product_variant_index in upsell_trigger_offer.product_variants
                                                                option(
                                                                    value=`${product_variant.id}`
                                                                    data-sku=`${product_variant.sku}`
                                                                    data-title=`${product_variant.title}`
                                                                    data-amount=`${product_variant.price}`
                                                                    data-compare-at-amount=`${product_variant.compare_at_price}`
                                                                    product_variant_index= `${product_variant_index}`
                                                                ) !{product_variant.title}

                                                .d-flex.justify-content-between.align-items-center 
                                                    .input-typs
                                                        button.btn-minius.purchase_quantity_minius -
                                                        input.quanitity(
                                                            readonly 
                                                            step='1', min='1',
                                                            name='purchase_quantity'
                                                            id=`purchase_quantity_${upsell_trigger_offer_index}`
                                                            value=`${upsell_trigger_offer.purchase_quantity}`
                                                        )
                                                        button.btn-plus.purchase_quantity_plus +

                                                    .upsell-price-wrapper.d-flex.flex-column.text-center.text-lg-right
                                                        if !(parseFloat(upsell_trigger_offer.compare_at_price) <= parseFloat(upsell_trigger_offer.product_price))
                                                            span.upsell-compare-price(
                                                                id=`upsell_compare_at_price_${upsell_trigger_offer_index}`
                                                            ) !{money_format} !{upsell_trigger_offer.compare_at_price}
                                                        span.upsell-price.accent.bold(
                                                            id=`upsell_product_price_${upsell_trigger_offer_index}`
                                                        ) !{money_format} !{upsell_trigger_offer.product_price}

                                        .upsell-description
                                            | !{upsell_trigger_offer.product_description}

                                        .upsell-buttons
                                            button.btn.btn-secondary.no_thank_upsell(
                                                upsell_trigger_offer_index=`${upsell_trigger_offer_index}`
                                            ) No, thanks

                                            button.btn.btn-primary.purchase_upsell(
                                                upsell_trigger_offer_id=`${upsell_trigger_offer.id}`
                                                upsell_trigger_offer_index=`${upsell_trigger_offer_index}`
                                            ) Purchase

block scripts
    script.
        var store_id = `!{store_id}`;
        var upsell_detail = !{JSON.stringify(upsell_detail)};
        var upsell_trigger_offers = !{JSON.stringify(upsell_trigger_offers)};

    script(type='text/javascript' src='/assets/js/custom/upsell_preview.js')